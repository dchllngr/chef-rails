<%= render 'nginx/w3tc.erb' %>

location ~ ^/assets/(img|js|css|fonts)/(.*)$ {
  expires 365d;
  try_files $uri $uri/ /wp-content/themes/osage/assets/$1/$2;
}
location ~ ^/plugins/(.*)$ {
  try_files $uri $uri/ /wp-content/plugins/$1;
}

location @engine_file_rewrite {
  rewrite ^/files/(.*(html|jpg|jpeg|gif|png|ico|css|zip|tgz|gz|rar|bz2|doc|xls|exe|pdf|ppt|docx|xlsx|pptx|txt|tar|mid|midi|wav|bmp|rtf|js))$ /wp-content/blogs.php?file=$1 last;
  rewrite ^/.*(/wp-.*/.*\\.(html|jpg|jpeg|gif|png|ico|css|zip|tgz|gz|rar|bz2|doc|xls|exe|pdf|ppt|docx|xlsx|pptx|txt|tar|mid|midi|wav|bmp|rtf|js))$ $1 last;
  rewrite ^/.*(/media/.*\\.(html|jpg|jpeg|gif|png|ico|css|zip|tgz|gz|rar|bz2|doc|xls|exe|pdf|ppt|docx|xlsx|pptx|txt|tar|mid|midi|wav|bmp|rtf|js))$ $1 last;
}

location / {
  try_files $uri $uri/ @engine_file_rewrite /index.php?$args;
}

location @website {
  include fastcgi_params;
  fastcgi_pass  php_<%= @user %>_<%= @name %>;
  fastcgi_param  SCRIPT_FILENAME  $document_root/index.php;
}
